"use strict";var Core={context:null,document:null,selection:null,sketch:null,pluginFolderPath:null,frameworks:{SketchPluginBoilerplate:{SPBWebViewMessageHandler:"SPBWebViewMessageHandler"}},getPluginFolderPath:function(e){var t=e.scriptPath.split("/");return t.splice(-3,3),t.join("/")},initWithContext:function(e){log("initWithContext"),this.context=e,this.document=e.document||e.actionContext.document||MSDocument.currentDocument(),this.selection=this.document.findSelectedLayers(),this.sketch=this.context.api(),this.pluginFolderPath=this.getPluginFolderPath(e),this.loadFrameworks(),log("loaded"),log(SPBWebViewMessageHandler)},loadFrameworks:function(){for(var e in this.frameworks)for(var t in this.frameworks[e]){var n=this.loadFramework(e,this.frameworks[e][t]);log("test"),log(n)}},loadFramework:function(e,t){if(log("Loading framework"),log(e),log(t),Mocha&&null==NSClassFromString(t)){var n=this.pluginFolderPath+"/Contents/Resources/frameworks/";log("frameworkDir="+n),log(this.context.scriptPath);return Mocha.sharedRuntime().loadFrameworkWithName_inDirectory(e,n)}return!0}},WebViewCore={identifierWindow:"satchel-debugger--window",identifierPanel:"satchel-debugger--panel",getFilePath:function(e){return Core.pluginFolderPath+"/Contents/Resources/webview/"+e},createWebView:function(e,t){var n=WKWebViewConfiguration.alloc().init(),i=SPBWebViewMessageHandler.alloc().init();n.userContentController().addScriptMessageHandler_name(i,"Sketch");var r=WKWebView.alloc().initWithFrame_configuration(t,n),o=NSURL.fileURLWithPath(this.getFilePath(e));return r.setAutoresizingMask(NSViewWidthSizable|NSViewHeightSizable),r.loadRequest(NSURLRequest.requestWithURL(o)),r},sendAction:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&e.evaluateJavaScript_completionHandler){var i="sketchBridge('"+JSON.stringify({name:t,payload:n})+"');";log("sendAction"),log(i);e.evaluateJavaScript_completionHandler(i,null)}},receiveAction:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];Core.document.showMessage("I received a message! ðŸ˜ŠðŸŽ‰ðŸŽ‰")}},WebViewWindow={open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"index.html",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:450,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:350,r=NSMakeRect(0,0,n,i),o=NSTitledWindowMask|NSWindowStyleMaskClosable|NSResizableWindowMask,a=NSPanel.alloc().initWithContentRect_styleMask_backing_defer(r,o,NSBackingStoreBuffered,!1);a.setMinSize({width:400,height:300}),NSThread.mainThread().threadDictionary()[e]=a;var u=WebViewCore.createWebView(t,r);a.title="Sketch Debugger",a.center(),a.contentView().addSubview(u),a.makeKeyAndOrderFront(null)},findWebView:function(e){return NSThread.mainThread().threadDictionary()[e].contentView().subviews()[0]},sendAction:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return WebViewCore.sendAction(this.findWebView(e),t,n)}},Formatter$1={toArray:function(e){if(Array.isArray(e))return e;for(var t=[],n=0;n<e.count();n++)t.push(e.objectAtIndex(n));return t}},WebViewPanel={toggle:function(e,t,n){this.isOpen(e)?this.close(e):this.open(e,t,n)},open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"index.html",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,i=NSMakeRect(0,0,n,600),r=Core.document.documentWindow().contentView();if(!r||this.isOpen())return!1;var o=r.subviews().objectAtIndex(0),a=WebViewCore.createWebView(t,i);a.identifier=e;for(var u=o.subviews(),c=[],l=!1,s=0;s<u.count();s++){var d=u.objectAtIndex(s);c.push(d),l||"view_canvas"!=d.identifier()||(c.push(a),l=!0)}l||c.push(a),o.subviews=c,o.adjustSubviews()},close:function(e){var t=Core.document.documentWindow().contentView();if(!t)return!1;var n=t.subviews().objectAtIndex(0),i=Formatter$1.toArray(n.subviews()).filter(function(t){return t.identifier()!=e});n.subviews=i,n.adjustSubviews()},isOpen:function(e){return!!this.findWebView(e)},findWebView:function(e){var t=Core.document.documentWindow().contentView();if(!t)return!1;var n=t.subviews().objectAtIndex(0);return Formatter$1.toArray(n.subviews()).find(function(t){return t.identifier()==e})},sendAction:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return WebViewCore.sendAction(this.findWebView(e))}},_extends$1=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},WebViewUtil=_extends$1({},WebViewCore,{Window:WebViewWindow,Panel:WebViewPanel}),DebugWindow={open:function(){WebViewUtil.Window.open(WebViewUtil.identifierWindow,"index.html",600,400)},sendLog:function(e,t){var n={ts:(new Date).getTime(),type:t,values:e.map(function(e){return DebugCore.prepareValue(e)}),stack:DebugCore.getStack(),file:DebugCore.getFileName()};log("I`ll send these logs:"),log(n),WebViewUtil.Window.sendAction(WebViewUtil.identifierWindow,"addLog",n)},clearLogs:function(){WebViewUtil.Window.sendAction(WebViewUtil.identifierWindow,"clearLogs")}},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DebugCore={TYPES:{DEFAULT:"default",WARNING:"warning",ERROR:"error",COUNTER:"counter",TIMER:"timer"},log:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){log(e)}),DebugWindow.sendLog(t,this.TYPES.DEFAULT)}),warn:function(){log("### WARN");for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){log(e)}),log("### WARN END"),DebugWindow.sendLog(t,this.TYPES.WARNING)},error:function(){log("### ERROR");for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){log(e)}),log("### ERROR END"),DebugWindow.sendLog(t,this.TYPES.ERROR)},count:function(e){},time:function(e){},timeEnd:function(e){},group:function(e){},groupEnd:function(e){},clear:function(){},trace:function(e){},prepareValue:function(e){var t="String",n=void 0===e?"undefined":_typeof(e);return e instanceof Error?t="Error":Array.isArray(e)?(t="Array",e=this.prepareArrayDeep(e)):"object"===n?e.isKindOfClass&&"function"==typeof e.class?(t=String(e.class()),"NSDictionary"==t||"__NSDictionaryM"==t?(t="NSDictionary",e=this.prepareObjectDeep(Object(e))):e="NSArray"==t||"NSMutuableArray"==t?this.prepareArrayDeep(Formatter.toArray(e)):t):(t="Object",e=this.prepareObjectDeep(e)):"function"===n?t="Function":e===!0||e===!1?t="Boolean":null===e||void 0===e||Number.isNaN(e)?t="Empty":"number"===n&&(t="Number"),{value:e,type:t}},prepareArrayDeep:function(e){var t=this;return e.map(function(e){return t.prepareValue(e)})},prepareObjectDeep:function(e){var t=this,n={};return Object.keys(e).forEach(function(i){n[i]=t.prepareValue(e[i])}),n},getStack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Error;if(!e||!e.stack)return[];var t=e.line,n=e.column,i=e.stack.split("\n");return i=i.map(function(e){return e.replace(/\s\g/,"")}),{stack:i,line:t,column:n}},getFileName:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Error).fileName}},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Debug$1=_extends({},DebugCore,{Window:DebugWindow});module.exports=Debug$1;
